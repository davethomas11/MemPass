function MemPass(a){function b(a){var b=new TextEncoder("utf-8").encode(a);return crypto.subtle.digest("SHA-256",b).then(function(a){return c(a)})}function c(a){for(var b=[],c=new DataView(a),d=0;d<c.byteLength;d+=4){var e=c.getUint32(d),f=e.toString(16),g="00000000",h=(g+f).slice(-g.length);b.push(h)}return b.join("")}a="undefined"!=typeof a?a:!1;var d=this,e=new MemPassOptions,f=new MemPassDice(a),g="",h=!0,j=inNode?a.crypto:crypto;inNode&&(j.getRandomValues=a.getRandomValues),e.loadDefaults();var k="";this.READY="READY",this.PENDING="PENDING",this.readyState=function(){return h?"PENDING":"READY"},this.getSeed=function(){return k},this.setSeed=function(a){k=a},this.getPhrase=function(){return g},this.setPhrase=function(a){g=a},this.getDice=function(){return f},this.getOptions=function(){return e},this.reSeed=function(a,b){function c(){"undefined"!=typeof chrome&&chrome.storage.sync.set({seed:k}),b&&b(k)}a?a.indexOf("|")?(k=d.parForOptions(a),c()):a?(k=a,c()):b&&b(k):d.newSeed(function(a,b){k=b?b:d.randomValue(),c()})},this.getIntialValue=function(a){return a+"-"+d.stringReverse(a)+"-|"+k+".)"},this.getIntialHash=function(a,b){d.sha256(d.getIntialValue(a),b)},this.generate=function(a,b){function c(a){e.characterLimit>0&&e.characterLimit<a.length&&(a=a.substring(0,e.characterLimit)),b(null,a)}g=a,d.getIntialHash(a,function(a,f){a?b(a,null):(e.specialChars.length>0&&(f=d.specialCharPass(f)),e.hasCapital&&(f=d.capitalLetterPass(f)),e.hasNumber||(f=d.removeNumberPass(f)),e.hasDiceWords?d.diceWordPass(f,c):c(f))})},this.memPassSyncKey=function(){return k+"|"+e.settingsString()},this.newSeed=function(a){var b=(new Date).getTime(),c=d.randomValue(),e=c+b;isChrome?chrome.system.cpu.getInfo(function(b){e+="_"+b.numOfProcessors,e+="_"+b.archName,e+="_"+b.features.join();var c=b.processors;for(p in c)e+="_"+c[p].user,e+="_"+c[p].kernel,e+="_"+c[p].idle,e+="_"+c[p].total;chrome.system.memory.getInfo(function(b){e+="_"+b.capacity,e+="_"+b.availableCapacity,chrome.system.storage.getInfo(function(b){for(i in b)e+="_"+b[i].id,e+="_"+b[i].name,e+="_"+b[i].type,e+="_"+b[i].capacity;d.sha256(e,a)})})}):d.sha256("-"+b+e,a)},this.loadSeed=function(){function a(){d.reSeed(null,function(){h=!1})}isChrome?chrome.storage.sync.get("seed",function(b){"undefined"!=typeof b.seed?(k=b.seed,h=!1):a()}):a()},this.parseSeedForOptions=function(a){var b=a.split("|");if(b.length>1){var c=b[1];b.length>1&&(c=a.replace(b[0]+"|","")),a=b[0],e.parseSettingsString(c)}return a},this.specialCharPass=function(a){for(var b={},c=0;c<a.length;c++){var f=a.charAt(c);"undefined"==typeof b[f]?b[f]=1:b[f]++}var g=0,h=[];for(c in b)h.push({character:c,occurences:b[c]});h.sort(function(a,b){return a.occurences==b.occurences?a.character>b.character:a.occurences-b.occurences});for(var i=e.specialChars.slice();i.length>0&&h.length>0;){var f=h[0].character,j=f.charCodeAt(0),k=j%i.length;(k>=i.length||0>k)&&(k=0);var l=i[k];a=g%e.capitalLetterMod==0?a.replace(d.regexEscape(f,"g"),l):a.replace(f,l),g++,h.shift(),i.splice(k,1)}return a},this.capitalLetterPass=function(a){for(var b=d.stringSum(a)%e.capitalLetterMod+1,c=0,f=!1,g=0;g<a.length;g++){var h=a.charAt(g).toString();if(h.match(/[a-z]/)&&(a=a.replace(h,h.toUpperCase()),f=!0,c++,b==c))break}return f||(a+=e.defaultUppercase),a},this.removeNumberPass=function(a){return a.replace(/[0-9]/g,e.numberReplace)},this.diceWordPass=function(a,b){function c(){if(0>=j)return void b(n.join("")+a);var d=i%j,g=i*l%h;(0>=g||g>=h)&&(g=1),f.wordAt(g,function(f){n.push(a.substring(0,d)),a=a.substring(d,a.length),e.specialChars.length>0?n.push(e.diceLeftBrace+f+e.diceRightBrace):n.push(f),j=a.length,l--,o++,m>=o?c():b(n.join("")+a)})}var h=0,i=d.stringSum(g+k),j=a.length-1,l=e.diceOffset,m=i%e.diceMod+1,n=[""],o=1;f.getWordCount(function(a){h=a,c()})},this.stringSum=function(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c);return b},this.randomValue=function(){var a=new Uint8Array(32);return j.getRandomValues(a),d.ua2text(a)},this.sha256=function(a,c){if(inNode){var d=j.createHash("sha256"),e=d.update(a,"utf8");c(null,e.digest("hex"))}else b(a).then(function(a){c(null,a)})},this.text2ua=function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b},this.ua2hex=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].toString(16);return b},this.ua2text=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},this.stringReverse=function(a){var b=/([\0-\u02FF\u0370-\u1AAF\u1B00-\u1DBF\u1E00-\u20CF\u2100-\uD7FF\uE000-\uFE1F\uFE30-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])([\u0300-\u036F\u1AB0-\u1AFF\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]+)/g,c=/([\uD800-\uDBFF])([\uDC00-\uDFFF])/g;a=a.replace(b,function(a,b,c){return reverse(c)+b}).replace(c,"$2$1");for(var d="",e=a.length;e--;)d+=a.charAt(e);return d},this.regexEscape=function(a,b){return RegExp(a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),b)},d.loadSeed()}function MemPassDice(a){function b(a,b){db=new m.Database(l),db.serialize(function(){db.get("SELECT word FROM words WHERE id = ?",a,function(a,c){a?(console.log(a),b("")):b(c.word)})}),db.close()}function c(a){db=new m.Database(l),db.serialize(function(){db.get("SELECT COUNT(*) AS wordCount FROM words",function(b,c){b?(console.log(b),a(0)):a(c.wordCount)})})}function d(a){f(function(b,c){if(b)console.log(b),a(0);else{var d=c.transaction(j,"readonly"),e=d.objectStore(j),f=e.index(k),g=f.count();g.onsuccess=function(){a(g.result),c.close()},g.onerror=function(){console.log(g.error),a(0),c.close()}}})}function e(a,b){f(function(c,d){if(c)console.log(c),b("");else{var e=d.transaction(j,"readonly"),f=e.objectStore(j),g=f.index(k),h=g.get(a);h.onsuccess=function(){b(h.result.word),d.close()},h.onerror=function(){b(""),d.close()}}})}function f(a){var b=indexedDB.open(g,h);b.onupgradeneeded=function(a){var b=a.target.result;if(!b.objectStoreNames.contains(j)){var c=b.createObjectStore(j,{keyPath:"id"});c.createIndex(k,"id",{unique:!0})}},b.onsuccess=function(){a(null,b.result)},b.onerror=function(){console.log(b.error),b.closePending=!0,a(b.error,null)}}var g="Words",h=1,j="words",k="wordId",l="words.sqlite3",m=!1;inNode&&a&&(m=a.sqlite3,l=a.sqlite3Path),this.getWordCount=function(a){isChrome?d(a):inNode?c(a):a(0)},this.wordAt=function(a,c){isChrome?e(a,c):inNode?b(a,c):c("")},this.nodeSqlLite3Install=function(a,b){db=new m.Database(l),db.serialize(function(){db.run("DROP TABLE IF EXISTS words"),db.run("CREATE TABLE IF NOT EXISTS words (id INTEGER, word TEXT)");var c=db.prepare("INSERT INTO words (id, word) VALUES (?,?)"),d=require(a),e=1;for(i in d){c.run(d[i].id,d[i].word);var f=e/d.length*100;e>1&&(process.stdout.clearLine(),process.stdout.cursorTo(0)),process.stdout.write("Progress: "+f+"% | "+e+" of "+d.length+" words done."),e++}console.log("Finalizing..."),c.finalize(b)}),db.close()},this.chromeInstall=function(a,b){f(function(c,d){if(c)console.log(c),a&&a(c,!1);else{var e=new XMLHttpRequest;e.onload=function(c){function e(c){if(c==g.length)return void f();var i=d.transaction(j,"readwrite"),k=i.objectStore(j),l=g[c].word,m=g[c].id,n={word:l,id:m},o=k.add(n);o.onsuccess=function(a){b&&b(n,m/h),e(++c)},o.onerror=function(b){console.log(b.target.error),a(b.target.error,null)}}function f(){d.close(),a&&a(null,!0)}var g=JSON.parse(c.target.response),h=g.length;e(0)},e.type="json",e.open("GET",chrome.extension.getURL("/word.json"),!0),e.send()}})}}function MemPassOptions(){this.specialCharMod=3,this.capitalLetterMod=7,this.diceMod=4,this.numberReplace="n",this.defaultUppercase="A",this.diceOffset=1e5,this.diceLeftBrace="-> ",this.diceRightBrace=" <-",this.hasNumber=!0,this.hasCapital=!0,this.hasDiceWords=!0,this.characterLimit=0,this.specialChars=["!","@","#","$","%","^","`","~","&","*","(","=","_","{","+","}"];var a=this,b=["hasNumber","hasCapital","hasDiceWords","characterLimit","specialChars"];this.reset=function(){a.hasNumber=!0,a.hasCapital=!0,a.hasDiceWords=!0,a.characterLimit=0,a.specialChars=["!","@","#","$","%","^","`","~","&","*","(","=","_","{","+","}"],a.saveDefaults()},this.getSpecialCharString=function(){var b="";for(i in a.specialChars)b+=a.specialChars[i];return b},this.loadDefaults=function(){isChrome&&chrome.storage.sync.get(null,function(c){for(i in b)"undefined"!=typeof c[b[i]]&&(a[b[i]]=c[b[i]])})},this.saveDefaults=function(){isChrome&&chrome.storage.sync.set({hasNumber:a.hasNumber,hasCapital:a.hasCapital,hasDiceWords:a.hasDiceWords,characterLimit:a.characterLimit,specialChars:a.specialChars})},this.settingsString=function(){var b="";return b+=a.hasNumber?1:0,b+=".",b+=a.hasCapital?1:0,b+=".",b+=a.hasDiceWords?1:0,b+=".",b+=a.characterLimit,b+=".",b+=a.getSpecialCharString()},this.parseSettingsString=function(b,c){var d=b.split(".");d.length>=4&&("0"===d[0]?a.hasNumber=!1:"1"===d[0]&&(a.hasNumber=!0),"0"===d[1]?a.hasCapital=!1:"1"===d[1]&&(a.hasCapital=!0),"0"===d[2]?a.hasDiceWords=!1:"1"===d[2]&&(a.hasDiceWords=!0),Number.isInteger(parseInt(d[3]))&&(a.characterLimit=parseInt(d[3])),d.length>4&&(a.specialChars=b.replace(/^([0-9]+.){4}/,"").split("")),c!==!1&&a.saveDefaults())}}var inNode=!1,isChrome="undefined"==typeof chrome?!1:!0;"undefined"==typeof window&&exports&&(inNode=!0,exports.MemPass=MemPass);
//# sourceMappingURL=mempass.min.js.map
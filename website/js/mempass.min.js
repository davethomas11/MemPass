function MemPass(a){function b(a){var b=new TextEncoder("utf-8").encode(a);return crypto.subtle.digest("SHA-256",b).then(function(a){return c(a)})}function c(a){for(var b=[],c=new DataView(a),d=0;d<c.byteLength;d+=4){var e=c.getUint32(d),f=e.toString(16),g="00000000",h=(g+f).slice(-g.length);b.push(h)}return b.join("")}a="undefined"!=typeof a&&a;var d=this,e=new MemPassOptions,f=new MemPassDice(a),g="",h=!0,j=inNode?a.crypto:crypto;inNode&&(j.getRandomValues=a.getRandomValues),e.loadDefaults();var k="";this.READY="READY",this.PENDING="PENDING",this.readyState=function(){return h?"PENDING":"READY"},this.getSeed=function(){return k},this.setSeed=function(a){k=a},this.getPhrase=function(){return g},this.setPhrase=function(a){g=a},this.getDice=function(){return f},this.getOptions=function(){return e},this.reSeed=function(a,b){function c(){"undefined"!=typeof chrome&&chrome.storage?chrome.storage.sync.set({seed:k}):"undefined"!=typeof Storage&&localStorage.setItem("mempass_seed",d.memPassSyncKey()),b&&b(k)}a?a.indexOf("|")!=-1?(k=d.parseSeedForOptions(a),c()):a&&(k=a,c()):d.newSeed(function(a,b){k=b?b:d.randomValue(),c()})},this.getIntialValue=function(a){return a+"-"+d.stringReverse(a)+"-|"+k+".)"},this.getIntialHash=function(a,b){d.sha256(d.getIntialValue(a),b)},this.generate=function(a,b){function c(a){e.hasNumber||(a=d.removeNumberPass(a)),e.applyLimitBeforeDice||(a=d.applyCharacterLimit(a)),a=e.hasCapital?d.capitalLetterPass(a):a.toLowerCase(),b(null,a)}g=a,d.getIntialHash(a,function(a,f){a?b(a,null):(e.specialChars.length>0&&(f=d.specialCharPass(f)),e.applyLimitBeforeDice&&(f=d.applyCharacterLimit(f)),e.hasDiceWords?d.diceWordPass(f,c):c(f))})},this.applyCharacterLimit=function(a){return e.characterLimit>0&&e.characterLimit<a.length&&(a=a.substring(0,e.characterLimit)),a},this.memPassSyncKey=function(){return k+"|"+e.settingsString()},this.newSeed=function(a){var b=(new Date).getTime(),c=d.randomValue(),e=c+b;isChrome&&chrome.system?chrome.system.cpu.getInfo(function(b){e+="_"+b.numOfProcessors,e+="_"+b.archName,e+="_"+b.features.join();var c=b.processors;for(p in c)e+="_"+c[p].user,e+="_"+c[p].kernel,e+="_"+c[p].idle,e+="_"+c[p].total;chrome.system.memory.getInfo(function(b){e+="_"+b.capacity,e+="_"+b.availableCapacity,chrome.system.storage.getInfo(function(b){for(i in b)e+="_"+b[i].id,e+="_"+b[i].name,e+="_"+b[i].type,e+="_"+b[i].capacity;d.sha256(e,a)})})}):d.sha256("-"+b+e,a)},this.loadSeed=function(){function a(){d.reSeed(null,function(){h=!1})}isChrome&&chrome.storage?chrome.storage.sync.get("seed",function(b){"undefined"!=typeof b.seed?(k=b.seed,h=!1):a()}):"undefined"!=typeof Storage&&""!=localStorage.getItem("mempass_seed")?d.reSeed(localStorage.getItem("mempass_seed"),function(a){d.setSeed(a)}):a()},this.parseSeedForOptions=function(a){var b=a.split("|");if(b.length>1){var c=b[1];b.length>1&&(c=a.replace(b[0]+"|","")),a=b[0],e.parseSettingsString(c)}return a},this.specialCharPass=function(a){for(var b={},c=0;c<a.length;c++){var f=a.charAt(c);"undefined"==typeof b[f]?b[f]=1:b[f]++}var g=0,h=[];for(c in b)h.push({character:c,occurences:b[c]});h.sort(function(a,b){return a.occurences==b.occurences?a.character.toString().charCodeAt(0)-b.character.toString().charCodeAt(0):a.occurences-b.occurences});for(var i=e.specialChars.slice();i.length>0&&h.length>0;){var f=h[0].character,j=f.charCodeAt(0),k=j%i.length;(k>=i.length||k<0)&&(k=0);var l=i[k];a=g%e.specialCharMod==0?a.replace(d.regexEscape(f,"g"),l):a.replace(f,l),g++,h.shift(),i.splice(k,1)}return a},this.capitalLetterPass=function(a){for(var b=d.stringSum(a)%e.capitalLetterMod+2,c=0,f=!1,g=!1,h=0;h<a.length;h++){var i=a.charAt(h).toString();if(i.match(/[a-zA-Z]/)&&(c%2==0?(a=a.replace(i,i.toUpperCase()),f=!0):(a=a.replace(i,i.toLowerCase()),g=!0),c++,b==c))break}return f||(a+=e.defaultUppercase),g||(a+=e.numberReplace),a},this.removeNumberPass=function(a){return a.replace(/[0-9]/g,e.numberReplace)},this.diceWordPass=function(a,b){function c(){if(j<=0)return void b(n.join("")+a);var d=i%j,g=i*l%h;(g<=0||g>=h)&&(g=1),f.wordAt(g,function(f){n.push(a.substring(0,d)),a=a.substring(d,a.length),e.specialChars.length>0?n.push(e.diceLeftBrace+f+e.diceRightBrace):n.push(f),j=a.length,l--,o++,o<=m?c():b(n.join("")+a)})}var h=0,i=d.stringSum(g+k),j=a.length-1,l=e.diceOffset,m=i%e.diceMod+1,n=[""],o=1;f.getWordCount(function(a){h=a,c()})},this.stringSum=function(a){for(var b=0,c=0;c<a.length;c++)b+=a.charCodeAt(c);return b},this.randomValue=function(){var a=new Uint8Array(32);return j.getRandomValues(a),d.ua2text(a)},this.sha256=function(a,c){if(inNode){var d=j.createHash("sha256"),e=d.update(a,"utf8");c(null,e.digest("hex"))}else chrome&&chrome.extension?b(a).then(function(a){c(null,a)}):c(null,Sha256.hash(a))},this.text2ua=function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b},this.ua2hex=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].toString(16);return b},this.ua2text=function(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},this.stringReverse=function(a){var b=/([\0-\u02FF\u0370-\u1AAF\u1B00-\u1DBF\u1E00-\u20CF\u2100-\uD7FF\uE000-\uFE1F\uFE30-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])([\u0300-\u036F\u1AB0-\u1AFF\u1DC0-\u1DFF\u20D0-\u20FF\uFE20-\uFE2F]+)/g,c=/([\uD800-\uDBFF])([\uDC00-\uDFFF])/g;a=a.replace(b,function(a,b,c){return reverse(c)+b}).replace(c,"$2$1");for(var d="",e=a.length;e--;)d+=a.charAt(e);return d},this.regexEscape=function(a,b){return RegExp(a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),b)},d.loadSeed()}function MemPassDice(a){function b(a,b){db=new s.Database(r),db.serialize(function(){db.get("SELECT word FROM words WHERE id = ?",a,function(a,c){a?(console.log(a),b("")):b(c.word)})}),db.close()}function c(a){db=new s.Database(r),db.serialize(function(){db.get("SELECT COUNT(*) AS wordCount FROM words",function(b,c){b?(console.log(b),a(0)):a(c.wordCount)})})}function d(b){var c=null;m?c=m:(c=require(a.wordJSONPath),m=c),b(c?c.length:0)}function e(b,c){var d=null;if(m?d=m:(d=require(a.wordJSONPath),m=d),d){var e=b-1;e>=0&&e<d.length?c(d[e].word):(console.log("Word index out of bounds: "+e),c(""))}else c("")}function f(a){if(m)return void a(m.length);var b=new XMLHttpRequest;b.onload=function(b){var c=JSON.parse(b.target.response);m=c,a(c.length)},b.onerror=function(b){console.log(b.error),a(0)},b.type="json",chrome&&chrome.extension?b.open("GET",chrome.extension.getURL("/word.json"),!0):b.open("GET","js/word.json",!0),b.send()}function g(a,b){if(m){var c=a-1;return void(c<0||c>=m.length?(console.log("Word index out of bounds: "+c),b("")):b(m[c].word))}var d=new XMLHttpRequest;d.onload=function(c){var d=JSON.parse(c.target.response);m=d;var e=a-1;e>=0&&e<d.length?b(d[e].word):(console.log("Word index out of bounds: "+e),b(""))},d.onerror=function(a){console.log(a.error),b("")},d.type="json",chrome&&chrome.extension?d.open("GET",chrome.extension.getURL("/word.json"),!0):d.open("GET","js/word.json",!0),d.send()}function h(){var a=new XMLHttpRequest;a.onload=function(a){m=JSON.parse(a.target.response)},a.onerror=function(a){console.log(a.error)},a.type="json",chrome&&chrome.extension?a.open("GET",chrome.extension.getURL("/word.json"),!0):a.open("GET","js/word.json",!0),a.send()}function j(a){l(function(b,c){if(b)console.log(b),a(0);else{var d=c.transaction(p,"readonly"),e=d.objectStore(p),f=e.index(q),g=f.count();g.onsuccess=function(){a(g.result),c.close()},g.onerror=function(){console.log(g.error),a(0),c.close()}}})}function k(a,b){l(function(c,d){if(c)console.log(c),b("");else{var e=d.transaction(p,"readonly"),f=e.objectStore(p),g=f.index(q),h=g.get(a);h.onsuccess=function(){b(h.result.word),d.close()},h.onerror=function(){b(""),d.close()}}})}function l(a){var b=indexedDB.open(n,o);b.onupgradeneeded=function(a){var b=a.target.result;if(!b.objectStoreNames.contains(p)){var c=b.createObjectStore(p,{keyPath:"id"});c.createIndex(q,"id",{unique:!0})}},b.onsuccess=function(){a(null,b.result)},b.onerror=function(){console.log(b.error),b.closePending=!0,a(b.error,null)}}inNode||"undefined"==typeof XMLHttpRequest||chrome&&chrome.storage||h();var m=null,n="Words",o=1,p="words",q="wordId",r="words.sqlite3",s=!1;inNode&&a&&(s=a.sqlite3,r=a.sqlite3Path),this.getWordCount=function(a){if(isChrome&&chrome.storage)chrome.storage.local.get("mempassDatabaseInstalled",function(b){b.mempassDatabaseInstalled?j(a):f(a)});else if(inNode){var b=require("fs");b.stat(r,function(b,e){b?d(a):c(a)})}else f(a)},this.wordAt=function(a,c){if(isChrome&&chrome.storage)chrome.storage.local.get("mempassDatabaseInstalled",function(b){b.mempassDatabaseInstalled?k(a,c):g(a,c)});else if(inNode){var d=require("fs");d.stat(r,function(d,f){d?e(a,c):b(a,c)})}else g(a,c)},this.nodeSqlLite3Install=function(a,b){db=new s.Database(r),db.serialize(function(){db.run("DROP TABLE IF EXISTS words"),db.run("CREATE TABLE IF NOT EXISTS words (id INTEGER, word TEXT)");var c=db.prepare("INSERT INTO words (id, word) VALUES (?,?)"),d=require(a),e=1;for(i in d){c.run(d[i].id,d[i].word);var f=e/d.length*100;e>1&&(process.stdout.clearLine(),process.stdout.cursorTo(0)),process.stdout.write("Progress: "+f+"% | "+e+" of "+d.length+" words done."),e++}console.log("Finalizing..."),c.finalize(b)}),db.close()},this.chromeInstall=function(a,b){l(function(c,d){if(c)console.log(c),a&&a(c,!1);else{var e=new XMLHttpRequest;e.onload=function(c){function e(c){if(c==g.length)return void f();var i=d.transaction(p,"readwrite"),j=i.objectStore(p),k=g[c].word,l=g[c].id,m={word:k,id:l},n=j.add(m);n.onsuccess=function(a){b&&b(m,l/h),e(++c)},n.onerror=function(b){console.log(b.target.error),a(b.target.error,null)}}function f(){d.close(),a&&a(null,!0)}var g=JSON.parse(c.target.response),h=g.length;e(0)},e.type="json",e.open("GET",chrome.extension.getURL("/word.json"),!0),e.send()}})}}function MemPassOptions(){this.specialCharMod=7,this.capitalLetterMod=7,this.diceMod=4,this.numberReplace="n",this.defaultUppercase="A",this.diceOffset=1e5,this.diceLeftBrace="-> ",this.diceRightBrace=" <-",this.applyLimitBeforeDice=!1,this.hasNumber=!0,this.hasCapital=!0,this.hasDiceWords=!0,this.characterLimit=0,this.specialChars=["!","@","#","$","%","^","`","~","&","*","(","=","_","{","+","}"];var a=["applyLimitBeforeDice","hasNumber","hasCapital","hasDiceWords","characterLimit","specialChars"],b=this;this.reset=function(){b.applyLimitBeforeDice=!1,b.hasNumber=!0,b.hasCapital=!0,b.hasDiceWords=!0,b.characterLimit=0,b.specialChars=["!","@","#","$","%","^","`","~","&","*","(","=","_","{","+","}"],b.saveDefaults()},this.getSpecialCharString=function(){for(var a="",c=0;c<b.specialChars.length;c++)a+=b.specialChars[c];return a},this.loadDefaults=function(){isChrome&&chrome.storage&&chrome.storage.sync.get(null,function(c){for(var d=0;d<a.length;d++)"undefined"!=typeof c[a[d]]&&(b[a[d]]=c[a[d]])})},this.saveDefaults=function(){if(isChrome){for(var c={},d=0;d<a.length;d++)c[a[d]]=b[a[d]];chrome.storage&&chrome.storage.sync.set(c)}},this.settingsString=function(){for(var c="",d=0;d<a.length;d++){var e=b[a[d]];c+="boolean"==typeof e?(e?1:0)+".":"object"==typeof e&&e.length>0?b.getSpecialCharString():e+"."}return c},this.parseSettingsString=function(c,d){var e=c.split("."),f=a.length-1;if(e.length>=a.length){for(var g=0;g<a.length;g++){var h=b[a[g]];"boolean"==typeof h?b[a[g]]=1==e[g]:"number"==typeof h&&(b[a[g]]=parseInt(e[g]))}if(e.length>f){var i=new RegExp("^([0-9]+.){"+f+"}");b.specialChars=c.replace(i,"").split("")}d!==!1&&b.saveDefaults()}}}var inNode=!1,isChrome="undefined"!=typeof chrome;if("undefined"==typeof chrome)var chrome={};"undefined"==typeof window&&exports&&(inNode=!0,exports.MemPass=MemPass);
//# sourceMappingURL=mempass.min.js.map